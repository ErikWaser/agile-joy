<!DOCTYPE HTML>
<html>
<head>
<script src="/js/d3.v7.min.js"></script>
<style>
    html,body {height: 100%; margin: 0}

#content .info {
  height: 20px;
}

#content .map path {
  fill: #aaa;
  stroke: #fff;
}

#content .bounding-box rect {
  fill: none;
  stroke: #333;
  stroke-dasharray: 2,1;
}

#content .centroid {
  display: none;
}

#content .centroid circle {
  fill: red;
}
</style>
</head>
<body>
  <div id="content">
    <div class="info">Hover over a country</div>
    <svg width="620px" height="600px">
      <g class="map"></g>
      <g class="bounding-box"><rect></rect></g>
      <g class="centroid"><circle r="4"></circle></g>
    </svg>
  </div>
<script>
/*
    Codes in GeoJSON file data/lan_3.0.geojson:
    code 01: Stockholms 
    code 03: Uppsala 
    code 04: Södermanlands 
    code 05: Östergötlands 
    code 06: Jönköpings 
    code 07: Kronobergs 
    code 08: Kalmar 
    code 09: Gotlands 
    code 10: Blekinge 
    code 12: Skåne 
    code 12: Hallands 
    code 14: Västra Götalands 
    code 17: Värmlands 
    code 18: Örebro 
    code 19: Västmanlands 
    code 20: Dalarnas 
    code 21: Gävleborgs 
    code 22: Västernorrlands 
    code 23: Jämtlands 
    code 24: Västerbottens 
    code 25: Norrbottens
*/

/* adjust CSV data to correspond to codes in GeoJSON file data/lan_3.0.geojson:
   TODO: could get_csv be done better? */
async function get_csv(){
    return await d3.dsv(
            ",",
            "./data/Folkhalsomyndigheten_Covid19_latest.csv",
            (d) =>
    {
      return {
        Datum: d.Statistikdatum,
        Total: d.Totalt_antal_fall,
        01: d.Stockholm,
        03: d.Uppsala,
        04: d.Sörmland,
        05: d.Östergötland,
        06: d.Jönköping,
        07: d.Kronoberg,
        08: d.Kalmar,
        09: d.Gotland,
        10: d.Blekinge,
        12: d.Halland,
        12: d.Skåne,
        14: d.Västra_Götaland,
        17: d.Värmland,
        18: d.Örebro,
        19: d.Västmanland,
        20: d.Dalarna,
        21: d.Gävleborg,
        22: d.Västernorrland,
        23: d.Jämtland_Härjedalen,
        24: d.Västerbotten,
        25: d.Norrbotten
      };
    });
}
    let svg = d3.select("svg");
    let projection = d3.geoMercator()
    .fitSize([620,600],svg);
/*	.scale(40)
	.translate([200, 280])
	.center([10, 5]);
   */

let geoGenerator = d3.geoPath()
	.projection(projection);
function handleMouseover(e, d) {
	let pixelArea = geoGenerator.area(d);
	let bounds = geoGenerator.bounds(d);
	let centroid = geoGenerator.centroid(d);
	let measure = geoGenerator.measure(d);

	d3.select('#content .info')
		.text(d.properties.name + ' (path.area = ' + pixelArea.toFixed(1) + ' path.measure = ' + measure.toFixed(1) + ')');

	d3.select('#content .bounding-box rect')
		.attr('x', bounds[0][0])
		.attr('y', bounds[0][1])
		.attr('width', bounds[1][0] - bounds[0][0])
		.attr('height', bounds[1][1] - bounds[0][1]);

	d3.select('#content .centroid')
		.style('display', 'inline')
		.attr('transform', 'translate(' + centroid + ')');
}

function update(geojson) {
	let u = d3.select('#content g.map')
		.selectAll('path')
		.data(geojson.features);

	u.enter()
		.append('path')
		.attr('d', geoGenerator)
		.on('mouseover', handleMouseover);
}

// REQUEST DATA
d3.json('/data/lan_5.0.geojson')
	.then(function(json) {
		update(json)
	});
</script>
</body>
</html>
